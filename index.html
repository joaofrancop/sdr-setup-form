<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configura√ß√£o do Agente - Setup</title>
  <style>
    :root{
      --primary:#2563eb;--primary-dark:#1e40af;--bg:#f0f7ff;--card:#fff;--text:#1f2937;--border:#e5e7eb
    }
    body{font-family:Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:20px;line-height:1.5}
    .container{max-width:800px;margin:40px auto;background:var(--card);padding:40px;border-radius:12px;box-shadow:0 10px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)}
    h1{color:var(--primary);text-align:center;margin-bottom:32px;font-size:2.1rem}
    h2{color:var(--primary-dark);border-bottom:2px solid var(--bg);padding-bottom:10px;margin:28px 0 16px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .full{grid-column:1 / -1}
    .form-group{margin-bottom:18px}
    label{display:block;font-weight:600;margin-bottom:8px}
    .sub{font-size:.85em;color:#6b7280;font-weight:400;margin-left:6px}
    input[type="text"],input[type="number"],input[type="tel"],input[type="url"],textarea,select{
      width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:16px;box-sizing:border-box
    }
    textarea{resize:vertical;min-height:92px}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .check{display:flex;align-items:center;gap:10px;padding:10px;background:#f8fafc;border:1px solid var(--border);border-radius:8px}
    input[type="checkbox"]{width:18px;height:18px;accent-color:var(--primary)}
    .file-drop{border:2px dashed var(--primary);padding:18px;text-align:center;border-radius:10px;background:#f8fbff}
    .muted{color:#6b7280;font-size:.9em}
    button.submit{width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-size:1.1rem;font-weight:700;margin-top:26px;cursor:pointer}
    button.submit:hover{background:var(--primary-dark)}
    @media (max-width:768px){.form-grid{grid-template-columns:1fr}.container{padding:22px;margin:10px auto}}
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ Setup do Agente IA</h1>

    <form id="agentForm">
      <!-- 1. Identidade -->
      <h2>1. Identidade B√°sica</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="AGENTE_NOME">Nome do Agente</label>
          <input id="AGENTE_NOME" name="AGENTE_NOME" type="text" required placeholder="Ex: Maia"/>
        </div>
        <div class="form-group">
          <label for="EMPRESA_NOME">Nome da Empresa</label>
          <input id="EMPRESA_NOME" name="EMPRESA_NOME" type="text" required placeholder="Ex: I am Studio"/>
        </div>
        <div class="form-group full">
          <label for="PRODUTO_OU_SERVICO">Produto ou Servi√ßo Principal</label>
          <input id="PRODUTO_OU_SERVICO" name="PRODUTO_OU_SERVICO" type="text" required placeholder="Ex: aula experimental de Pilates"/>
        </div>
      </div>

      <!-- 2. Comportamento -->
      <h2>2. Comportamento & Estilo</h2>
      <div class="form-grid">
        <div class="form-group check">
          <input id="FLAG_USAR_EMOJIS" type="checkbox" checked/>
          <label for="FLAG_USAR_EMOJIS" style="margin:0">Usar Emojis ü§©</label>
        </div>
        <div class="form-group check">
          <input id="FLAG_USAR_AUDIO" type="checkbox"/>
          <label for="FLAG_USAR_AUDIO" style="margin:0">Permitir √Åudio üéôÔ∏è</label>
        </div>
        <div class="form-group">
          <label for="MAX_CARACTERES_POR_MSG">M√°x. Caracteres/Msg</label>
          <input id="MAX_CARACTERES_POR_MSG" type="number" value="200"/>
        </div>
        <div class="form-group full">
          <label for="sanitizador_evitar">O que evitar? <span class="sub">(separe por v√≠rgulas)</span></label>
          <input id="sanitizador_evitar" type="text" placeholder="Ex: textos longos, jarg√µes"/>
        </div>
      </div>

      <!-- 3. Intelig√™ncia de Vendas -->
      <h2>3. Intelig√™ncia de Vendas</h2>
      <div class="form-group full">
        <label for="ICP_DESCRICAO">Descri√ß√£o do ICP (Perfil Ideal)</label>
        <textarea id="ICP_DESCRICAO" placeholder="Quem √© o cliente ideal? Ex: Adultos de 25-55 anos, rotina de escrit√≥rio..."></textarea>
      </div>
      <div class="form-group full">
        <label for="SCRIPT_VENDAS_CLIENTE_TEXTO">Fluxo atual de atendimento / Script de Vendas</label>
        <textarea id="SCRIPT_VENDAS_CLIENTE_TEXTO" style="min-height:140px" placeholder="Cole aqui o texto base/fluxo atual da abordagem..."></textarea>
      </div>
      <div class="form-group full">
        <label for="DORES_PRINCIPAIS">Dores Principais do Cliente <span class="sub">(uma por linha)</span></label>
        <textarea id="DORES_PRINCIPAIS" placeholder="dor lombar e rigidez&#10;falta de condicionamento&#10;baixa motiva√ß√£o"></textarea>
      </div>

      <!-- 4. Qualifica√ß√£o -->
      <h2>4. Processo de Qualifica√ß√£o</h2>
      <div class="form-grid">
        <div class="form-group full">
          <label for="QUALIFICACAO_PERGUNTAS">Perguntas de Qualifica√ß√£o <span class="sub">(uma por linha)</span></label>
          <textarea id="QUALIFICACAO_PERGUNTAS" style="min-height:120px" placeholder="Voc√™ pratica atividade hoje?&#10;O que mais te incomoda?"></textarea>
        </div>
        <div class="form-group full">
          <label for="CRITERIOS_LEAD_QUALIFICADO">Crit√©rio de Lead Qualificado (o ‚Äúgatilho‚Äù)</label>
          <input id="CRITERIOS_LEAD_QUALIFICADO" type="text" placeholder="Ex: Interesse real + agenda em at√© 7 dias"/>
        </div>
      </div>

      <!-- 5. Regras de Neg√≥cio / Seguran√ßa / Ferramentas -->
      <h2>5. Regras de Neg√≥cio, Seguran√ßa e Ferramentas</h2>

      <div class="form-group full">
        <label for="REGRAS_DE_NEGOCIO">Regras de Neg√≥cio <span class="sub">(uma por linha ‚Äì aplicaremos no prompt)</span></label>
        <textarea id="REGRAS_DE_NEGOCIO" placeholder="N√£o enviar pre√ßos sem avalia√ß√£o&#10;Atender somente Curitiba e regi√£o"></textarea>
      </div>

      <div class="form-group full">
        <label for="ACOES_PROIBIDAS_ADICIONAIS">A√ß√µes Proibidas <span class="sub">(uma por linha)</span></label>
        <textarea id="ACOES_PROIBIDAS_ADICIONAIS" style="min-height:90px" placeholder="Enviar valores detalhados sem avalia√ß√£o&#10;Prometer cura m√©dica"></textarea>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="CANAL_TRANSBORDO">Telefone para Transbordo (Humano)</label>
          <input id="CANAL_TRANSBORDO" type="tel" placeholder="+55 (DDD) 9xxxx-xxxx"/>
        </div>
        <div class="form-group">
          <label for="CURADOR_MODO">Modo do Curador</label>
          <select id="CURADOR_MODO">
            <option value="refinar">Refinar (Padr√£o)</option>
            <option value="criar">Criar (Mais criativo)</option>
          </select>
        </div>
      </div>

      <div class="form-group full">
        <label for="MENSAGEM_NAO_QUALIFICADO">Mensagem de "N√£o Qualificado"</label>
        <textarea id="MENSAGEM_NAO_QUALIFICADO" placeholder="Texto educado para dispensar leads fora do perfil."></textarea>
      </div>

      <h3 class="muted">Tools habilitadas</h3>
      <div class="form-grid">
        <div class="check">
          <input id="TOOL_SECRETARIA" type="checkbox" checked/>
          <label for="TOOL_SECRETARIA" style="margin:0">Secretaria (Agendamento)</label>
        </div>
        <div class="check">
          <input id="TOOL_ENVIO_AUDIO" type="checkbox" disabled/>
          <label for="TOOL_ENVIO_AUDIO" style="margin:0">Envio de √Åudio (bloqueado se flag no topo estiver OFF)</label>
        </div>
        <div class="check">
          <input id="TOOL_EXEMPLO_CRM" type="checkbox"/>
          <label for="TOOL_EXEMPLO_CRM" style="margin:0">Exemplo: Integra√ß√£o CRM (poss√≠vel implementa√ß√£o)</label>
        </div>
        <div class="check">
          <input id="TOOL_EXEMPLO_RAG" type="checkbox"/>
          <label for="TOOL_EXEMPLO_RAG" style="margin:0">Exemplo: Base de Conhecimento / RAG</label>
        </div>
        <div class="check">
          <input id="TOOL_EXEMPLO_CALC" type="checkbox"/>
          <label for="TOOL_EXEMPLO_CALC" style="margin:0">Exemplo: Calculadora</label>
        </div>
      </div>

      <!-- Arquivos -->
      <h2>üìÇ Arquivos de Apoio</h2>
      <div class="form-group full">
        <label for="arquivos_imagens">Imagens do Agente / Logos (v√°rias)</label>
        <input id="arquivos_imagens" name="arquivos_imagens" type="file" accept="image/png, image/jpeg" multiple class="file-drop" />
        <div class="muted" style="margin-top:6px">Voc√™ pode selecionar m√∫ltiplas imagens.</div>
      </div>

      <button id="btnSubmit" type="submit" class="submit submit-btn">üöÄ Criar Agente</button>
    </form>
  </div>

  <script>
    // ========= CONFIG =========
    const N8N_WEBHOOK_URL = 'https://n8nbluelephant.up.railway.app/webhook/3ba80772-7612-4a54-a6c4-e4e3e5854e6d';

    // util: transforma texto -> array
    function textToArray(text, sep = '\n'){
      if(!text) return [];
      return text.split(sep).map(s => s.trim()).filter(Boolean);
    }

    // vincula a tool de √°udio √† flag do topo
    const flagAudio = document.getElementById('FLAG_USAR_AUDIO');
    const toolAudio = document.getElementById('TOOL_ENVIO_AUDIO');
    function syncAudioTool(){
      toolAudio.checked = flagAudio.checked;
      toolAudio.disabled = !flagAudio.checked;
    }
    flagAudio.addEventListener('change', syncAudioTool);
    syncAudioTool();

    document.getElementById('agentForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      const original = btn.innerText;
      btn.innerText = 'Enviando... ‚è≥'; btn.disabled = true;

      try{
        // 1) Coleta
        const raw = {
          AGENTE_NOME: document.getElementById('AGENTE_NOME').value,
          EMPRESA_NOME: document.getElementById('EMPRESA_NOME').value,
          PRODUTO_OU_SERVICO: document.getElementById('PRODUTO_OU_SERVICO').value,

          FLAG_USAR_EMOJIS: document.getElementById('FLAG_USAR_EMOJIS').checked,
          FLAG_USAR_AUDIO: flagAudio.checked,
          MAX_CARACTERES_POR_MSG: document.getElementById('MAX_CARACTERES_POR_MSG').value,

          // Sanitizador reduzido (apenas "evitar")
          SANITIZADOR_ESTILO_PREFERENCIAS: {
            evitar: textToArray(document.getElementById('sanitizador_evitar').value, ',')
          },

          ICP_DESCRICAO: document.getElementById('ICP_DESCRICAO').value,
          SCRIPT_VENDAS_CLIENTE_TEXTO: document.getElementById('SCRIPT_VENDAS_CLIENTE_TEXTO').value,
          DORES_PRINCIPAIS: textToArray(document.getElementById('DORES_PRINCIPAIS').value, '\n'),

          QUALIFICACAO_PERGUNTAS: textToArray(document.getElementById('QUALIFICACAO_PERGUNTAS').value, '\n'),
          CRITERIOS_LEAD_QUALIFICADO: document.getElementById('CRITERIOS_LEAD_QUALIFICADO').value,

          REGRAS_DE_NEGOCIO: textToArray(document.getElementById('REGRAS_DE_NEGOCIO').value, '\n'),
          ACOES_PROIBIDAS_ADICIONAIS: textToArray(document.getElementById('ACOES_PROIBIDAS_ADICIONAIS').value, '\n'),

          CANAL_TRANSBORDO: document.getElementById('CANAL_TRANSBORDO').value,
          CURADOR_MODO: document.getElementById('CURADOR_MODO').value,
          MENSAGEM_NAO_QUALIFICADO: document.getElementById('MENSAGEM_NAO_QUALIFICADO').value,

          FLAGS_EXTRAS: { permitir_case_curto: true },

          TOOLS_ENABLED: {
            secretaria: document.getElementById('TOOL_SECRETARIA').checked,
            envio_audio: toolAudio.checked, // espelha a flag
            exemplo_crm: document.getElementById('TOOL_EXEMPLO_CRM').checked,
            exemplo_rag: document.getElementById('TOOL_EXEMPLO_RAG').checked,
            exemplo_calculadora: document.getElementById('TOOL_EXEMPLO_CALC').checked
          }
        };

        // 2) FormData
        const fd = new FormData();
        for(const k in raw){
          let v = raw[k];
          if(typeof v === 'object') v = JSON.stringify(v);
          fd.append(k, v);
        }

        // 3) Multi-imagens
        const files = document.getElementById('arquivos_imagens').files;
        const imageKeys = [];
        for(let i=0;i<files.length;i++){
          const key = `imagem_${i}`;
          fd.append(key, files[i]);
          imageKeys.push(key);
        }
        fd.append('IMAGENS_KEYS', JSON.stringify(imageKeys));

        // 4) Envia
        const resp = await fetch(N8N_WEBHOOK_URL, { method:'POST', body: fd });
        if(resp.ok){
          alert('‚úÖ Sucesso! Configura√ß√£o enviada.');
        } else {
          const t = await resp.text().catch(()=> '');
          alert('‚ùå Erro ao enviar.\n' + t);
        }
      }catch(err){
        console.error(err);
        alert('‚ùå Erro de conex√£o.');
      }finally{
        btn.innerText = original; btn.disabled = false;
      }
    });
  </script>
</body>
</html>
